"use strict";(globalThis.webpackChunkaicraft_website=globalThis.webpackChunkaicraft_website||[]).push([[664],{9444(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"api/layers","title":"Layers","description":"#include","source":"@site/docs/api/layers.md","sourceDirName":"api","slug":"/api/layers","permalink":"/docs/api/layers","draft":false,"unlisted":false,"editUrl":"https://github.com/TobiasTesauri/Aicraft/tree/main/docs/api/layers.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Layers"},"sidebar":"docsSidebar","previous":{"title":"Autograd","permalink":"/docs/api/autograd"},"next":{"title":"Loss Functions","permalink":"/docs/api/loss"}}');var a=r(4848),s=r(8453);const i={sidebar_position:4,title:"Layers"},c="Layers API",d={},o=[{value:"Dense (Fully Connected)",id:"dense-fully-connected",level:2},{value:"Conv2D",id:"conv2d",level:2},{value:"MaxPool2D",id:"maxpool2d",level:2},{value:"BatchNorm",id:"batchnorm",level:2},{value:"Dropout",id:"dropout",level:2},{value:"Flatten",id:"flatten",level:2},{value:"Layer Summary",id:"layer-summary",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"layers-api",children:"Layers API"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"#include <aicraft/layers.h>"})}),"\n",(0,a.jsx)(n.h2,{id:"dense-fully-connected",children:"Dense (Fully Connected)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_tensor* weight;  // [out_features, in_features]\r\n    ac_tensor* bias;    // [out_features]\r\n    ac_size in_features;\r\n    ac_size out_features;\r\n} ac_dense;\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_dense_init(&layer, in_features, out_features);  // He initialization\r\nac_tensor* out = ac_dense_forward(&layer, input);   // out = input @ W^T + b\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Backward"}),": Autograd computes ",(0,a.jsx)(n.code,{children:"dW"}),", ",(0,a.jsx)(n.code,{children:"dB"}),", ",(0,a.jsx)(n.code,{children:"dInput"})," automatically via MATMUL + BIAS_ADD ops."]}),"\n",(0,a.jsx)(n.h2,{id:"conv2d",children:"Conv2D"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_tensor* weight;     // [out_ch, in_ch, kH, kW]\r\n    ac_tensor* bias;       // [out_ch]\r\n    int in_channels, out_channels;\r\n    int kernel_size, stride, padding;\r\n    // Cached for backward:\r\n    float* im2col_buf;\r\n    int batch, in_h, in_w, out_h, out_w;\r\n} ac_conv2d;\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_conv2d_init(&conv, in_channels, out_channels, kernel_size, stride, padding);\r\nac_tensor* out = ac_conv2d_forward(&conv, input);\r\n// input: [batch, in_ch, H, W]\r\n// output: [batch, out_ch, outH, outW]\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Implementation"}),": Uses ",(0,a.jsx)(n.strong,{children:"im2col + GEMM"})," approach (same as Caffe/cuDNN):"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Unfold input patches into columns"}),"\n",(0,a.jsx)(n.li,{children:"GEMM: filters \xd7 columns \u2192 output"}),"\n",(0,a.jsx)(n.li,{children:"Cache im2col buffer for backward"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"maxpool2d",children:"MaxPool2D"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    int pool_size, stride;\r\n    int* indices;  // Argmax indices for backward\r\n} ac_maxpool2d;\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_maxpool2d_init(&pool, pool_size, stride);\r\nac_tensor* out = ac_maxpool2d_forward(&pool, input);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Backward"}),": Gradient routed only to max elements via stored indices."]}),"\n",(0,a.jsx)(n.h2,{id:"batchnorm",children:"BatchNorm"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_tensor* gamma;        // Scale parameter [channels]\r\n    ac_tensor* beta;         // Shift parameter [channels]\r\n    float* running_mean;     // Running mean (inference)\r\n    float* running_var;      // Running variance (inference)\r\n    int num_features;\r\n    float momentum, epsilon;\r\n} ac_batchnorm;\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_batchnorm_init(&bn, num_features);\r\nac_tensor* out = ac_batchnorm_forward(&bn, input, is_training);\r\n// is_training=1: use batch stats, update running stats\r\n// is_training=0: use running stats\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dropout",children:"Dropout"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    float p;         // Drop probability\r\n    uint8_t* mask;   // Binary mask for backward\r\n} ac_dropout;\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_dropout_init(&drop, 0.5f);  // 50% dropout\r\nac_tensor* out = ac_dropout_forward(&drop, input, is_training);\r\n// Uses inverted dropout: scale by 1/(1-p) during training\r\n// No-op during inference\n"})}),"\n",(0,a.jsx)(n.h2,{id:"flatten",children:"Flatten"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"ac_tensor* out = ac_flatten_forward(input);\r\n// Zero-copy view: shares data pointer, no allocation\r\n// Reshapes [batch, c, h, w] \u2192 [batch, c*h*w]\n"})}),"\n",(0,a.jsx)(n.h2,{id:"layer-summary",children:"Layer Summary"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Layer"}),(0,a.jsx)(n.th,{children:"Forward"}),(0,a.jsx)(n.th,{children:"Backward"}),(0,a.jsx)(n.th,{children:"Init"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Dense"}),(0,a.jsx)(n.td,{children:"GEMM + bias"}),(0,a.jsx)(n.td,{children:"dW, dB, dX via autograd"}),(0,a.jsx)(n.td,{children:"He"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Conv2D"}),(0,a.jsx)(n.td,{children:"im2col + GEMM"}),(0,a.jsx)(n.td,{children:"Full im2col-based grads"}),(0,a.jsx)(n.td,{children:"He"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"MaxPool2D"}),(0,a.jsx)(n.td,{children:"Max selection + index storage"}),(0,a.jsx)(n.td,{children:"Gradient routing"}),(0,a.jsx)(n.td,{children:"\u2014"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"BatchNorm"}),(0,a.jsx)(n.td,{children:"Normalize + scale/shift"}),(0,a.jsx)(n.td,{children:"Stabilized formula"}),(0,a.jsx)(n.td,{children:"\u03b3=1, \u03b2=0"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Dropout"}),(0,a.jsx)(n.td,{children:"Random mask \xd7 scale"}),(0,a.jsx)(n.td,{children:"Mask-gated gradient"}),(0,a.jsx)(n.td,{children:"\u2014"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Flatten"}),(0,a.jsx)(n.td,{children:"Zero-copy reshape"}),(0,a.jsx)(n.td,{children:"Shape restore"}),(0,a.jsx)(n.td,{children:"\u2014"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>c});var t=r(6540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);