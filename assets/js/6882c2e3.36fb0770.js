"use strict";(globalThis.webpackChunkaicraft_website=globalThis.webpackChunkaicraft_website||[]).push([[160],{7877(e,n,r){r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"api/optimizer","title":"Optimizer","description":"#include","source":"@site/docs/api/optimizer.md","sourceDirName":"api","slug":"/api/optimizer","permalink":"/docs/api/optimizer","draft":false,"unlisted":false,"editUrl":"https://github.com/TobiasTesauri/Aicraft/tree/main/docs/api/optimizer.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Optimizer"},"sidebar":"docsSidebar","previous":{"title":"Loss Functions","permalink":"/docs/api/loss"},"next":{"title":"Memory","permalink":"/docs/api/memory"}}');var i=r(4848),l=r(8453);const t={sidebar_position:6,title:"Optimizer"},c="Optimizer API",s={},d=[{value:"Adam / AdamW",id:"adam--adamw",level:2},{value:"SGD",id:"sgd",level:2},{value:"Gradient Clipping",id:"gradient-clipping",level:2},{value:"Global L2-norm clipping",id:"global-l2-norm-clipping",level:3},{value:"Per-element value clipping",id:"per-element-value-clipping",level:3},{value:"Learning Rate Schedulers",id:"learning-rate-schedulers",level:2},{value:"Step Decay",id:"step-decay",level:3},{value:"Cosine Annealing",id:"cosine-annealing",level:3},{value:"Exponential Decay",id:"exponential-decay",level:3},{value:"Using with Optimizer",id:"using-with-optimizer",level:3}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"optimizer-api",children:"Optimizer API"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"#include <aicraft/optimizer.h>"})}),"\n",(0,i.jsxs)(n.p,{children:["All optimizer step functions are ",(0,i.jsx)(n.strong,{children:"SIMD-accelerated"})," with AVX2/NEON vectorized loops."]}),"\n",(0,i.jsx)(n.h2,{id:"adam--adamw",children:"Adam / AdamW"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_param_group* params;\r\n    float lr, beta1, beta2, eps, weight_decay;\r\n    int t;                     // Timestep counter\r\n    float* m;                  // First moment (per-param)\r\n    float* v;                  // Second moment (per-param)\r\n} ac_adam;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_adam opt;\r\nac_adam_init(&opt, &params,\r\n    0.001f,   // learning rate\r\n    0.9f,     // beta1 (first moment decay)\r\n    0.999f,   // beta2 (second moment decay)\r\n    1e-8f,    // epsilon\r\n    0.0f,     // weight decay (0 = Adam, >0 = AdamW)\r\n    0         // initial timestep\r\n);\r\n\r\n// In training loop:\r\nac_adam_step(&opt);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"weight_decay > 0"}),", applies ",(0,i.jsx)(n.strong,{children:"decoupled weight decay"})," (AdamW):"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"\u03b8(t+1) = \u03b8(t) - \u03b7 * (m\u0302(t) / (\u221av\u0302(t) + \u03b5) + \u03bb * \u03b8(t))"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"sgd",children:"SGD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_param_group* params;\r\n    float lr, momentum, weight_decay;\r\n    float* velocity;           // Momentum buffers\r\n} ac_sgd;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_sgd opt;\r\nac_sgd_init(&opt, &params,\r\n    0.01f,    // learning rate\r\n    0.9f,     // momentum\r\n    0.0001f   // weight decay\r\n);\r\n\r\n// In training loop:\r\nac_sgd_step(&opt);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"gradient-clipping",children:"Gradient Clipping"}),"\n",(0,i.jsx)(n.h3,{id:"global-l2-norm-clipping",children:"Global L2-norm clipping"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_clip_grad_norm(&params, 1.0f);\r\n// Computes total L2 norm across all params\r\n// If norm > max_norm, scales all gradients by (max_norm / norm)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"per-element-value-clipping",children:"Per-element value clipping"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_clip_grad_value(&params, 0.5f);\r\n// Clamps each gradient element to [-value, +value]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-rate-schedulers",children:"Learning Rate Schedulers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct {\r\n    ac_lr_type type;\r\n    float base_lr, gamma, min_lr;\r\n    int step_size, total_steps;\r\n} ac_lr_scheduler;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-decay",children:"Step Decay"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_lr_scheduler sched;\r\nac_lr_scheduler_init(&sched, AC_LR_STEP,\r\n    0.01f,    // base_lr\r\n    30,       // step_size (decay every 30 epochs)\r\n    0.1f,     // gamma (multiply by 0.1)\r\n    0, 0\r\n);\r\n\r\nfloat lr = ac_lr_scheduler_get(&sched, epoch);\r\n// lr = base_lr * gamma^(epoch / step_size)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cosine-annealing",children:"Cosine Annealing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_lr_scheduler_init(&sched, AC_LR_COSINE,\r\n    0.01f,    // base_lr\r\n    0, 0,\r\n    200,      // total_steps\r\n    0.0001f   // min_lr\r\n);\r\n// lr = min_lr + 0.5 * (base_lr - min_lr) * (1 + cos(\u03c0 * epoch / total))\n"})}),"\n",(0,i.jsx)(n.h3,{id:"exponential-decay",children:"Exponential Decay"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_lr_scheduler_init(&sched, AC_LR_EXPONENTIAL,\r\n    0.01f,    // base_lr\r\n    0,\r\n    0.95f,    // gamma (multiply each epoch)\r\n    0, 0\r\n);\r\n// lr = base_lr * gamma^epoch\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-with-optimizer",children:"Using with Optimizer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"for (int epoch = 0; epoch < num_epochs; epoch++) {\r\n    float lr = ac_lr_scheduler_get(&sched, epoch);\r\n    opt.lr = lr;  // Update optimizer's learning rate\r\n    \r\n    // ... training step ...\r\n    ac_adam_step(&opt);\r\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>c});var a=r(6540);const i={},l=a.createContext(i);function t(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);