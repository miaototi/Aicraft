"use strict";(globalThis.webpackChunkaicraft_website=globalThis.webpackChunkaicraft_website||[]).push([[806],{481(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"benchmarks","title":"Benchmarks","description":"Performance measurements of Aicraft\'s core operations. Run benchmarks with:","source":"@site/docs/benchmarks.md","sourceDirName":".","slug":"/benchmarks","permalink":"/docs/benchmarks","draft":false,"unlisted":false,"editUrl":"https://github.com/TobiasTesauri/Aicraft/tree/main/docs/benchmarks.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"Benchmarks"},"sidebar":"docsSidebar","previous":{"title":"Vulkan Backend","permalink":"/docs/api/vulkan"},"next":{"title":"Design Decisions","permalink":"/docs/design-decisions"}}');var i=r(4848),t=r(8453);const l={sidebar_position:11,title:"Benchmarks"},c="Benchmarks",d={},a=[{value:"Benchmark Suite",id:"benchmark-suite",level:2},{value:"1. GEMM Throughput",id:"1-gemm-throughput",level:3},{value:"2. MLP Forward Pass",id:"2-mlp-forward-pass",level:3},{value:"3. Full Training Step",id:"3-full-training-step",level:3},{value:"4. Element-wise Operations",id:"4-element-wise-operations",level:3},{value:"5. Memory Allocation",id:"5-memory-allocation",level:3},{value:"6. Dot Product",id:"6-dot-product",level:3},{value:"Running Your Own Benchmarks",id:"running-your-own-benchmarks",level:2},{value:"Comparison Targets",id:"comparison-targets",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"benchmarks",children:"Benchmarks"})}),"\n",(0,i.jsx)(n.p,{children:"Performance measurements of Aicraft's core operations. Run benchmarks with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd build\r\ncmake .. -DCMAKE_BUILD_TYPE=Release\r\ncmake --build . --config Release\r\n./aicraft_bench\n"})}),"\n",(0,i.jsx)(n.h2,{id:"benchmark-suite",children:"Benchmark Suite"}),"\n",(0,i.jsx)(n.h3,{id:"1-gemm-throughput",children:"1. GEMM Throughput"}),"\n",(0,i.jsx)(n.p,{children:"Matrix multiplication (512\xd7512 \xd7 512\xd7512):"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Backend"}),(0,i.jsx)(n.th,{children:"Target"}),(0,i.jsx)(n.th,{children:"Metric"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AVX2 (BLIS-style)"}),(0,i.jsx)(n.td,{children:"Desktop x86_64"}),(0,i.jsx)(n.td,{children:"GFLOPS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AVX-512"}),(0,i.jsx)(n.td,{children:"Server x86_64"}),(0,i.jsx)(n.td,{children:"GFLOPS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ARM NEON"}),(0,i.jsx)(n.td,{children:"Raspberry Pi / Mobile"}),(0,i.jsx)(n.td,{children:"GFLOPS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Vulkan GPU"}),(0,i.jsx)(n.td,{children:"Discrete/Integrated GPU"}),(0,i.jsx)(n.td,{children:"GFLOPS"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"The BLIS-style GEMM uses:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Panel packing for cache-aligned access"}),"\n",(0,i.jsx)(n.li,{children:"Architecture-specific micro-kernels (6\xd732, 6\xd716, 6\xd78)"}),"\n",(0,i.jsx)(n.li,{children:"Thread-parallel outer loop for large matrices"}),"\n",(0,i.jsx)(n.li,{children:"L1 prefetch hints (AVX2)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-mlp-forward-pass",children:"2. MLP Forward Pass"}),"\n",(0,i.jsx)(n.p,{children:"4-layer network: 784 \u2192 256 \u2192 256 \u2192 128 \u2192 10, batch=32"}),"\n",(0,i.jsx)(n.p,{children:"Measures end-to-end inference latency including:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dense GEMM \xd7 4"}),"\n",(0,i.jsx)(n.li,{children:"ReLU activations \xd7 3"}),"\n",(0,i.jsx)(n.li,{children:"Softmax output"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-full-training-step",children:"3. Full Training Step"}),"\n",(0,i.jsx)(n.p,{children:"Complete training iteration including:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Forward pass (GEMM + activations)"}),"\n",(0,i.jsx)(n.li,{children:"Loss computation (cross-entropy)"}),"\n",(0,i.jsx)(n.li,{children:"Backward pass (autograd, 22 op types)"}),"\n",(0,i.jsx)(n.li,{children:"Gradient clipping (L2-norm)"}),"\n",(0,i.jsx)(n.li,{children:"Adam optimizer step (SIMD-vectorized)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-element-wise-operations",children:"4. Element-wise Operations"}),"\n",(0,i.jsx)(n.p,{children:"1M elements: add + mul + relu + scale"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Architecture"}),(0,i.jsx)(n.th,{children:"Throughput"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AVX2"}),(0,i.jsx)(n.td,{children:"M elements/sec"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"NEON"}),(0,i.jsx)(n.td,{children:"M elements/sec"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Scalar"}),(0,i.jsx)(n.td,{children:"M elements/sec"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"5-memory-allocation",children:"5. Memory Allocation"}),"\n",(0,i.jsx)(n.p,{children:"1000\xd7 4KB block allocations:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Allocator"}),(0,i.jsx)(n.th,{children:"Time"}),(0,i.jsx)(n.th,{children:"Speedup"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"malloc"})}),(0,i.jsx)(n.td,{children:"Baseline"}),(0,i.jsx)(n.td,{children:"1\xd7"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Arena (",(0,i.jsx)(n.code,{children:"ac_arena_alloc"}),")"]}),(0,i.jsx)(n.td,{children:"Faster"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"N\xd7"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"The arena allocator uses bump-pointer allocation \u2014 O(1) with no free-list traversal or system calls after the initial block allocation."}),"\n",(0,i.jsx)(n.h3,{id:"6-dot-product",children:"6. Dot Product"}),"\n",(0,i.jsx)(n.p,{children:"1M element dot product:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Architecture"}),(0,i.jsx)(n.th,{children:"GFLOPS"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AVX2"}),(0,i.jsx)(n.td,{children:"Measured"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"NEON"}),(0,i.jsx)(n.td,{children:"Measured"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Scalar"}),(0,i.jsx)(n.td,{children:"Measured"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"running-your-own-benchmarks",children:"Running Your Own Benchmarks"}),"\n",(0,i.jsxs)(n.p,{children:["The benchmark source is in ",(0,i.jsx)(n.a,{href:"https://github.com/your-github-username/Aicraft/blob/main/benchmarks/bench_main.cpp",children:"benchmarks/bench_main.cpp"}),". Each benchmark:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Runs a warm-up iteration"}),"\n",(0,i.jsxs)(n.li,{children:["Times N iterations with ",(0,i.jsx)(n.code,{children:"ac_timer"})]}),"\n",(0,i.jsx)(n.li,{children:"Reports throughput in appropriate units (GFLOPS, M elements/sec, \u03bcs)"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"ac_timer timer;\r\nac_timer_start(&timer);\r\n\r\nfor (int i = 0; i < iterations; i++) {\r\n    ac_gemm(A, B, C, M, N, K);\r\n}\r\n\r\ndouble elapsed = ac_timer_stop(&timer);\r\ndouble gflops = (2.0 * M * N * K * iterations) / (elapsed * 1e9);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"comparison-targets",children:"Comparison Targets"}),"\n",(0,i.jsx)(n.p,{children:"For a fair comparison, benchmark against:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Library"}),(0,i.jsx)(n.th,{children:"Command"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OpenBLAS"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"OPENBLAS_NUM_THREADS=1 ./bench_openblas"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Intel MKL"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MKL_NUM_THREADS=1 ./bench_mkl"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Eigen"}),(0,i.jsx)(n.td,{children:"Single-threaded GEMM"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PyTorch (CPU)"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"torch.mm()"})," with ",(0,i.jsx)(n.code,{children:"OMP_NUM_THREADS=1"})]})]})]})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Benchmark results vary significantly by hardware. Always run on your target platform for meaningful comparisons."})})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>c});var s=r(6540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);